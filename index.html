<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Python Remote Runner</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #fafafa;
      color: #212121;
      font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      padding: 24px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      background: #ffffff;
      border-radius: 8px;
      padding: 32px;
      margin-bottom: 24px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-left: 4px solid #1976d2;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 500;
      color: #1976d2;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header p {
      color: #616161;
      font-size: 14px;
    }

    .editor-section {
      background: #ffffff;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 24px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .section-header {
      background: #f5f5f5;
      padding: 16px 24px;
      border-bottom: 1px solid #e0e0e0;
      font-weight: 500;
      color: #424242;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .input-group {
      padding: 24px;
      border-bottom: 1px solid #e0e0e0;
    }

    .input-group:last-child {
      border-bottom: none;
    }

    .input-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #424242;
      font-size: 14px;
    }

    .input-field {
      width: 100%;
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      padding: 12px 16px;
      color: #212121;
      font-family: inherit;
      font-size: 14px;
      transition: all 0.2s ease;
      outline: none;
    }

    .input-field:focus {
      border-color: #1976d2;
      box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.1);
    }

    .input-field::placeholder {
      color: #9e9e9e;
    }

    .code-editor-container {
      position: relative;
    }

    .code-editor {
      height: 400px;
      resize: vertical;
      font-family: 'Roboto Mono', 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      line-height: 1.5;
      background: #fafafa;
      border: 1px solid #e0e0e0;
    }

    .code-suggestions {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      padding: 8px;
      font-size: 12px;
      color: #616161;
      max-width: 200px;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .code-editor-container:hover .code-suggestions {
      opacity: 1;
    }

    .lint-indicators {
      margin-top: 8px;
      font-size: 12px;
    }

    .lint-error {
      color: #d32f2f;
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 4px;
    }

    .lint-warning {
      color: #f57c00;
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 4px;
    }

    .lint-info {
      color: #1976d2;
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 4px;
    }

    .button-container {
      padding: 24px;
      background: #f5f5f5;
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .run-button {
      background: #1976d2;
      border: none;
      border-radius: 4px;
      padding: 12px 24px;
      color: white;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .run-button:hover:not(:disabled) {
      background: #1565c0;
      box-shadow: 0 2px 8px rgba(25, 118, 210, 0.3);
    }

    .run-button:disabled {
      background: #bdbdbd;
      cursor: not-allowed;
    }

    .secondary-button {
      background: transparent;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      padding: 12px 20px;
      color: #616161;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .secondary-button:hover {
      background: #f5f5f5;
      border-color: #bdbdbd;
    }

    .loader {
      display: none;
      align-items: center;
      gap: 8px;
      color: #616161;
      font-size: 14px;
    }

    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid #e0e0e0;
      border-top: 2px solid #1976d2;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .results-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    @media (max-width: 768px) {
      .results-section {
        grid-template-columns: 1fr;
      }
    }

    .result-card {
      background: #ffffff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .result-header {
      padding: 16px 24px;
      font-weight: 500;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #e0e0e0;
    }

    .logs-header {
      background: #e3f2fd;
      color: #1565c0;
    }

    .output-header {
      background: #e8f5e8;
      color: #2e7d32;
    }

    .error-header {
      background: #ffebee;
      color: #c62828;
    }

    .result-content {
      padding: 20px;
      height: 250px;
      overflow-y: auto;
      font-family: 'Roboto Mono', 'Consolas', monospace;
      font-size: 13px;
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-word;
      background: #fafafa;
    }

    .result-content::-webkit-scrollbar {
      width: 6px;
    }

    .result-content::-webkit-scrollbar-track {
      background: #f5f5f5;
    }

    .result-content::-webkit-scrollbar-thumb {
      background: #bdbdbd;
      border-radius: 3px;
    }

    .result-content::-webkit-scrollbar-thumb:hover {
      background: #9e9e9e;
    }

    .logs-content {
      color: #424242;
    }

    .output-content {
      color: #2e7d32;
    }

    .error-content {
      color: #c62828;
    }

    .empty-state {
      color: #9e9e9e;
      font-style: italic;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      background: #ffffff;
    }

    .copy-button {
      background: transparent;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      padding: 4px 8px;
      color: #616161;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .copy-button:hover {
      background: #f5f5f5;
      border-color: #bdbdbd;
    }

    .error-full {
      grid-column: 1 / -1;
      margin-top: 24px;
    }

    .status-bar {
      background: #ffffff;
      border-radius: 8px;
      padding: 16px 24px;
      margin-top: 24px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      justify-content: between;
      align-items: center;
      font-size: 14px;
      color: #616161;
    }

    .status-info {
      display: flex;
      gap: 24px;
    }

    .snackbar {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: #323232;
      color: white;
      padding: 14px 24px;
      border-radius: 4px;
      font-size: 14px;
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .snackbar.show {
      transform: translateX(-50%) translateY(0);
    }

    .snackbar.error {
      background: #d32f2f;
    }

    .package-suggestions {
      margin-top: 8px;
      font-size: 12px;
      color: #616161;
    }

    .suggestion-chip {
      display: inline-block;
      background: #e3f2fd;
      color: #1565c0;
      padding: 4px 8px;
      border-radius: 12px;
      margin: 2px 4px 2px 0;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .suggestion-chip:hover {
      background: #bbdefb;
    }

    .code-metrics {
      display: flex;
      gap: 16px;
      font-size: 12px;
      color: #757575;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19.14,7.5A2.86,2.86 0 0,1 22,10.36V14.14A2.86,2.86 0 0,1 19.14,17H12C12,17.39 12.32,17.96 12.71,18.35L17,22.64A1,1 0 0,1 16.29,24H7.71A1,1 0 0,1 7,22.64L11.29,18.35C11.68,17.96 12,17.39 12,17H4.86A2.86,2.86 0 0,1 2,14.14V10.36A2.86,2.86 0 0,1 4.86,7.5H19.14M9,10.5V11.5H15V10.5H9Z"/>
        </svg>
        Python Remote Executor
      </h1>
      <p>Execute Python code remotely with intelligent linting and package management</p>
    </div>

    <div class="editor-section">
      <div class="section-header">
        Code Editor
        <div>
          <span id="lintStatus">✓ Ready</span>
        </div>
      </div>
      
      <div class="input-group">
        <label class="input-label" for="packages">Dependencies</label>
        <input 
          type="text" 
          id="packages" 
          class="input-field"
          placeholder="numpy pandas matplotlib requests"
          autocomplete="off"
        >
        <div class="package-suggestions">
          <strong>Popular packages:</strong>
          <span class="suggestion-chip" onclick="addPackage('numpy')">numpy</span>
          <span class="suggestion-chip" onclick="addPackage('pandas')">pandas</span>
          <span class="suggestion-chip" onclick="addPackage('matplotlib')">matplotlib</span>
          <span class="suggestion-chip" onclick="addPackage('requests')">requests</span>
          <span class="suggestion-chip" onclick="addPackage('scipy')">scipy</span>
          <span class="suggestion-chip" onclick="addPackage('scikit-learn')">scikit-learn</span>
        </div>
      </div>
      
      <div class="input-group">
        <label class="input-label" for="code">Python Code</label>
        <div class="code-editor-container">
          <textarea 
            id="code" 
            class="input-field code-editor"
            placeholder="# Write your Python code here
print('Hello, World!')

# Import packages and start coding
# Example:
# import numpy as np
# arr = np.array([1, 2, 3, 4, 5])
# print(f'Array: {arr}')
# print(f'Mean: {np.mean(arr)}')"
            spellcheck="false"
          ></textarea>
          <div class="code-suggestions">
            <strong>💡 Tips:</strong><br>
            • Use Ctrl+Enter to run<br>
            • Check syntax as you type<br>
            • Import suggestions available
          </div>
        </div>
        <div class="lint-indicators" id="lintIndicators"></div>
        <div class="code-metrics" id="codeMetrics"></div>
      </div>
      
      <div class="button-container">
        <button id="runBtn" class="run-button">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
          </svg>
          <span id="runText">Execute</span>
        </button>
        <button id="formatBtn" class="secondary-button">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3,3H21V5H3V3M3,7H15V9H3V7M3,11H21V13H3V11M3,15H15V17H3V15M3,19H21V21H3V19Z"/>
          </svg>
          Format
        </button>
        <button id="clearBtn" class="secondary-button">Clear</button>
        <div class="loader" id="loader">
          <div class="spinner"></div>
          <span>Executing...</span>
        </div>
      </div>
    </div>

    <div class="results-section">
      <div class="result-card">
        <div class="result-header logs-header">
          <span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M13.5,17.5C13.5,18.33 12.83,19 12,19A1.5,1.5 0 0,1 10.5,17.5V14.5C10.5,13.67 11.17,13 12,13A1.5,1.5 0 0,1 13.5,14.5V17.5M12,11.5A1.5,1.5 0 0,1 10.5,10A1.5,1.5 0 0,1 12,8.5A1.5,1.5 0 0,1 13.5,10A1.5,1.5 0 0,1 12,11.5Z"/>
            </svg>
            Installation Logs
          </span>
          <button class="copy-button" onclick="copyContent('logs')">Copy</button>
        </div>
        <div class="result-content logs-content" id="logs">
          <div class="empty-state">No package installation required</div>
        </div>
      </div>
      
      <div class="result-card">
        <div class="result-header output-header">
          <span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9,22A1,1 0 0,1 8,21V18H4A2,2 0 0,1 2,16V4C2,2.89 2.9,2 4,2H20A2,2 0 0,1 22,4V16A2,2 0 0,1 20,18H13.9L10.2,21.71C10,21.9 9.75,22 9.5,22V22H9M10,16V19.08L13.08,16H20V4H4V16H10Z"/>
            </svg>
            Output
          </span>
          <button class="copy-button" onclick="copyContent('output')">Copy</button>
        </div>
        <div class="result-content output-content" id="output">
          <div class="empty-state">Output will appear here</div>
        </div>
      </div>
    </div>

    <div class="result-card error-full">
      <div class="result-header error-header">
        <span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M11,15H13V17H11V15M11,7H13V13H11V7M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z"/>
          </svg>
          Errors & Warnings
        </span>
        <button class="copy-button" onclick="copyContent('error')">Copy</button>
      </div>
      <div class="result-content error-content" id="error">
        <div class="empty-state">No errors detected</div>
      </div>
    </div>

    <div class="status-bar">
      <div class="status-info">
        <span id="executionStats">Ready to execute</span>
        <span id="codeStats">Lines: 0 | Characters: 0</span>
      </div>
    </div>
  </div>

  <div class="snackbar" id="snackbar">Message</div>

  <script>
    let executionCount = 0;
    let startTime;

    // Basic Python linting patterns
    const lintRules = [
      {
        pattern: /^(\s*)print\s*\(/gm,
        type: 'info',
        message: 'Consider using f-strings for better formatting'
      },
      {
        pattern: /^\s*import\s+\*/gm,
        type: 'warning',
        message: 'Avoid wildcard imports (import *)'
      },
      {
        pattern: /^\s*(def|class)\s+[a-z]/gm,
        type: 'warning',
        message: 'Use PascalCase for classes, snake_case for functions'
      },
      {
        pattern: /==/g,
        type: 'info',
        message: 'Consider using "is" for None comparisons'
      },
      {
        pattern: /^\s*except:\s*$/gm,
        type: 'warning',
        message: 'Specify exception types instead of bare except'
      }
    ];

    document.getElementById("runBtn").addEventListener("click", executeCode);
    document.getElementById("clearBtn").addEventListener("click", clearAll);
    document.getElementById("formatBtn").addEventListener("click", formatCode);

    document.getElementById("code").addEventListener("input", (e) => {
      lintCode();
      updateCodeStats();
    });

    document.getElementById("code").addEventListener("keydown", (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        e.preventDefault();
        executeCode();
      }
    });

    async function executeCode() {
      const packages = document.getElementById("packages").value.trim();
      const code = document.getElementById("code").value.trim();
      
      if (!code) {
        showSnackbar("Please enter Python code to execute", "error");
        return;
      }
      
      const runBtn = document.getElementById("runBtn");
      const loader = document.getElementById("loader");
      const runText = document.getElementById("runText");
      
      loader.style.display = "flex";
      runBtn.disabled = true;
      runText.textContent = "Executing...";
      startTime = Date.now();
      
      updateLintStatus("🔄 Executing...");
      updateResultSection("logs", "Installing dependencies...", false);
      updateResultSection("output", "Running code...", false);
      updateResultSection("error", "Checking for errors...", false);
      
      try {
        const response = await fetch("https://triflix-coder.hf.space/execute/", {
          method: "POST",
          headers: { 
            "Content-Type": "application/json",
            "Accept": "application/json"
          },
          body: JSON.stringify({ 
            package_name: packages || "", 
            script_content: code 
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        const executionTime = Date.now() - startTime;
        
        updateResultSection("logs", data.pip_install_output || "No dependencies installed", true);
        updateResultSection("output", data.script_execution_output || "No output generated", true);
        updateResultSection("error", data.error_output || "", true);
        
        executionCount++;
        document.getElementById("executionStats").textContent = 
          `Execution #${executionCount} • ${executionTime}ms`;
        
        if (!data.error_output) {
          showSnackbar("Code executed successfully");
          updateLintStatus("✅ Executed successfully");
        } else {
          updateLintStatus("❌ Execution failed");
        }
        
      } catch (error) {
        updateResultSection("logs", "Connection failed", true);
        updateResultSection("output", "", true);
        updateResultSection("error", `Network Error: ${error.message}\n\nPlease check your connection and try again.`, true);
        showSnackbar("Failed to execute code", "error");
        updateLintStatus("❌ Connection failed");
      } finally {
        loader.style.display = "none";
        runBtn.disabled = false;
        runText.textContent = "Execute";
      }
    }

    function clearAll() {
      document.getElementById("packages").value = "";
      document.getElementById("code").value = "";
      updateResultSection("logs", "", true);
      updateResultSection("output", "", true);
      updateResultSection("error", "", true);
      document.getElementById("executionStats").textContent = "Ready to execute";
      document.getElementById("lintIndicators").innerHTML = "";
      executionCount = 0;
      updateLintStatus("✓ Ready");
      updateCodeStats();
      showSnackbar("All fields cleared");
    }

    function formatCode() {
      const codeArea = document.getElementById("code");
      let code = codeArea.value;
      
      // Basic Python formatting
      code = code.replace(/\t/g, "    "); // Replace tabs with 4 spaces
      code = code.replace(/,(\S)/g, ", $1"); // Add space after commas
      code = code.replace(/([=!<>])(\S)/g, "$1 $2"); // Add space after operators
      code = code.replace(/(\S)([=!<>])/g, "$1 $2"); // Add space before operators
      
      codeArea.value = code;
      showSnackbar("Code formatted");
      lintCode();
    }

    function lintCode() {
      const code = document.getElementById("code").value;
      const indicators = document.getElementById("lintIndicators");
      indicators.innerHTML = "";
      
      let issueCount = 0;
      
      lintRules.forEach(rule => {
        const matches = [...code.matchAll(rule.pattern)];
        matches.forEach(match => {
          issueCount++;
          const lineNum = code.substring(0, match.index).split('\n').length;
          const indicator = document.createElement("div");
          indicator.className = `lint-${rule.type}`;
          indicator.innerHTML = `
            <span>${rule.type === 'error' ? '●' : rule.type === 'warning' ? '⚠' : 'ⓘ'}</span>
            Line ${lineNum}: ${rule.message}
          `;
          indicators.appendChild(indicator);
        });
      });
      
      if (issueCount === 0 && code.trim()) {
        updateLintStatus("✅ No issues found");
      } else if (code.trim()) {
        updateLintStatus(`⚠ ${issueCount} suggestion${issueCount !== 1 ? 's' : ''}`);
      } else {
        updateLintStatus("✓ Ready");
      }
    }

    function updateLintStatus(status) {
      document.getElementById("lintStatus").textContent = status;
    }

    function updateCodeStats() {
      const code = document.getElementById("code").value;
      const lines = code.split('\n').length;
      const chars = code.length;
      document.getElementById("codeStats").textContent = `Lines: ${lines} | Characters: ${chars}`;
    }

    function updateResultSection(sectionId, content, isComplete) {
      const section = document.getElementById(sectionId);
      
      if (!content || content.trim() === "") {
        const emptyMessages = {
          logs: "No installation logs",
          output: "No output generated", 
          error: "No errors detected"
        };
        section.innerHTML = `<div class="empty-state">${emptyMessages[sectionId]}</div>`;
      } else {
        section.textContent = content;
        if (isComplete) {
          section.scrollTop = section.scrollHeight;
        }
      }
    }

    function copyContent(sectionId) {
      const content = document.getElementById(sectionId).textContent;
      if (content && !content.includes("No ") && !content.includes("will appear")) {
        navigator.clipboard.writeText(content).then(() => {
          showSnackbar("Content copied to clipboard");
        }).catch(() => {
          showSnackbar("Failed to copy content", "error");
        });
      }
    }

    function showSnackbar(message, type = "success") {
      const snackbar = document.getElementById("snackbar");
      snackbar.textContent = message;
      snackbar.className = `snackbar ${type === "error" ? "error" : ""} show`;
      
      setTimeout(() => {
        snackbar.classList.remove("show");
      }, 3000);
    }

    function addPackage(packageName) {
      const packagesInput = document.getElementById("packages");
      const currentPackages = packagesInput.value.trim();
      
      if (!currentPackages.includes(packageName)) {
        packagesInput.value = currentPackages ? `${currentPackages} ${packageName}` : packageName;
        showSnackbar(`${packageName} added to dependencies`);
      }
    }

    // Initialize
    updateCodeStats();
  </script>
</body>
</html>
